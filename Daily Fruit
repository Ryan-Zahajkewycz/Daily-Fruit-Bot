const { Client, GatewayIntentBits } = require('discord.js');
const express = require('express');
const cron = require('node-cron');

const client = new Client({ intents: [GatewayIntentBits.Guilds, GatewayIntentBits.GuildMessages] });
const app = express();
const port = process.env.PORT || 3000;

const fruits = [
  { name: "Apple", fact: "Apples float because 25% of their volume is air." },
  { name: "Banana", fact: "Bananas are berries, but strawberries aren’t!" },
  { name: "Grape", fact: "Grapes explode when you put them in the microwave." },
  { name: "Pear", fact: "There are over 3000 verieties of pears" },
  { name: "Blueberry", fact: "Blueberrys are purple in the inside" },
  { name: "Durian", fact: "🤢" },
  { name: "Watermelon", fact: "Fact: the red part is the best" },
];

const channelId = '1403889496415539200';

function getRandomFruit() {
  return fruits[Math.floor(Math.random() * fruits.length)];
}

client.once('ready', () => {
  console.log(`Logged in as ${client.user.tag}!`);

  // Schedule the task to run at 9:00 AM every day
  cron.schedule('0 9 * * *', () => {
    sendDailyFruit();
  }, {
    timezone: "YOUR_TIMEZONE" // e.g. "America/New_York"
  });

  // Optional: send once right on startup
  sendDailyFruit();
});

async function sendDailyFruit() {
  const channel = await client.channels.fetch(channelId);
  if (!channel) return console.log("Channel not found");

  const fruit = getRandomFruit();
  channel.send(`🍎 Today's fruit is: **${fruit.name}**\nFun fact: ${fruit.fact}`);
}

app.get('/', (req, res) => {
  res.send('Bot is running!');
});

app.listen(port, () => {
  console.log(`Webserver listening on port ${port}`);
});

client.login(process.env.TOKEN);
